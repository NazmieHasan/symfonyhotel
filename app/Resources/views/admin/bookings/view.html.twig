{% extends 'base.html.twig' %}

{% block body %}

    <div class="container body-content text-center">
        <div class="row">
            <div class="col-sm-8 offset-sm-2">
                <h2>Booking Details [ #{{ booking.id }} ]</h2>
                <p>
                    Reserved by email <span class="cl-bold"> {{ booking.userId.email }} </span>
                    on <span class="cl-bold"> {{ booking.dateAdded|date("Y-m-d H:i:s") }} </span>
                </p>
                <h4 class="cl-bold">
                    Status: <span class="text-danger"> {{ booking.status.name }} </span> 
                </h4>
                <p>
                    Checkin: <span class="cl-bold"> {{ booking.checkin|date("Y-m-d") }} </span> | 
                    Checkout: <span class="cl-bold"> {{ booking.checkout|date("Y-m-d") }} </span> | 
                    <span class="cl-bold"> {{ booking.days }} day(s) </span></p>
                <p>
                    Payment: <span class="cl-bold"> {{ booking.payment.name }} </span> |
                    Total Amount: <span class="cl-bold"> ${{ booking.totalAmount}} </span> 
                </p>
                <p>
                    Paid Amount: <span class="cl-bold"> ${{ booking.paidAmount}} </span> | 
                    Payment Amount: <span class="cl-bold"> ${{ booking.paymentAmount}} </span>
                </p>
                <p>
                    Category: <span class="cl-bold"> {{ booking.category.name }} </span> |
                    Adults: <span class="icon-find"> {% for i in 1..booking.adults %} {{ "&#xf007;" }} {% endfor %} </span> |
                    Child Bed: <span class="cl-bold"> {% if ( booking.childBed == 1 ) %} Yes {% else %} No {% endif %}</span> |
                    Room: <span class="cl-bold"> {{ booking.room.number }} </span> |
                <p>
                    <a class="btn btn-success btn-xs" href="{{ path('admin_booking_edit', {id: booking.id}) }}">Edit Booking</a>
                    <a class="btn btn-danger btn-xs" href="{{ path('admin_booking_delete', {id: booking.id}) }}" onClick="return confirm('Are you sure you want to delete?')">Delete Booking</a>
                </p>
        
                {% if stays|length < booking.adults %} 
                    <h4><button class="btn btn-danger btn-outline" id="Add">Add stay for this booking</button></h4>
                    <div id="add_stay"></div> 
                {% else %} 
                    <h4><button class="btn btn-danger btn-outline" disabled>Add stay for this booking</button></h4>
                {% endif %} 
        
                <h2>All stays for this booking</h2>
                {% if stays|length == 0 %} 
                    <p>No result for stays</p>
                {% else %} 
                    <div class="row">
                        <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th>Stay Id</th>
                            <th>Guest</th> 
                        </tr>
                        </thead>
                        <tbody>
                            {% for stay in stays %}
                            <tr>
                                <td><a href="{{ path('admin_stay_view', {id: stay.id}) }}"> {{ stay.id }} </a></td>
                                <td><a href="{{ path('admin_guest_view', {id: stay.guest.id}) }}"> {{ stay.guest.firstName }} {{ stay.guest.fathersName }} {{ stay.guest.lastName }} </a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        </table>
                    </div>
                {% endif %} 
            </div>
        </div>  
    </div>
    
    <script>
        $('#Add').click(function () {
            $('#add_stay').empty();
            let addStayForm =
                `
                <form method="post" action="{{ path('admin_stay_create', { id: booking.id}) }}">
                    <div class="form-group">
                        <div class="col-sm-12">
                            <select class="form-control" id="stay_guest" name="stay[guest]">
                                <option value="">Choise Guest</option>
                                {% for guest in guests %}
                                    <option value="{{ guest.id }}">{{ guest.personalNumber }} {{ guest.firstName }} {{ guest.fathersName }} {{ guest.lastName }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12">
                            <textarea class="form-control" name="stay[note]" id="stay_note" rows="6" placeholder="Note"></textarea>   
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-12">
                            <h4><button type="submit" class="btn btn-danger">Submit</button></h4>
                        </div>
                    </div>
                    {{  form_row(form._token) }}
                </form>
                `;
                
            $('#add_stay').append(addStayForm);
            $('#add_stay').toggle();
        })
    </script>

{% endblock %}